<!-- üîπ SECCI√ìN CHECADOR -->
<section id="checardor-section" style="display:none;">
  <h2>Checador de Wallet</h2>
  <input type="text" id="walletAddress" placeholder="Ingresa tu direcci√≥n de Osmosis">
  <button onclick="consultarWallet()">Consultar</button>

  <div id="walletInfo" style="margin-top:20px;"></div>

  <h3>√öltimas propuestas de gobernanza</h3>
  <div id="proposalsList"></div>
</section>

<script>
async function consultarWallet() {
  const wallet = document.getElementById("walletAddress").value.trim();
  const walletInfo = document.getElementById("walletInfo");
  const proposalsList = document.getElementById("proposalsList");

  if (!wallet) {
    walletInfo.innerHTML = "<p style='color:red;'>Por favor ingresa una direcci√≥n de Osmosis.</p>";
    return;
  }

  walletInfo.innerHTML = "<p>üîç Consultando datos para: <b>" + wallet + "</b>...</p>";

  try {
    // üîπ 1. Consultar balance de OSMO
    const balanceResp = await fetch(`https://lcd.osmosis.zone/cosmos/bank/v1beta1/balances/${wallet}`);
    const balanceData = await balanceResp.json();
    const osmoBalance = balanceData.balances.find(b => b.denom === "uosmo");
    const osmo = osmoBalance ? (osmoBalance.amount / 1_000_000).toFixed(2) : 0;

    // üîπ 2. Consultar staking
    const stakingResp = await fetch(`https://lcd.osmosis.zone/cosmos/staking/v1beta1/delegations/${wallet}`);
    const stakingData = await stakingResp.json();
    let staked = 0;
    if (stakingData.delegation_responses) {
      staked = stakingData.delegation_responses
        .reduce((acc, d) => acc + parseInt(d.balance.amount), 0) / 1_000_000;
    }

    walletInfo.innerHTML = `
      <p><b>Balance OSMO:</b> ${osmo}</p>
      <p><b>OSMO en staking:</b> ${staked.toFixed(2)}</p>
    `;

    // üîπ 3. Consultar √∫ltimas propuestas
    const proposalsResp = await fetch("https://lcd.osmosis.zone/cosmos/gov/v1beta1/proposals?pagination.reverse=true&pagination.limit=5");
    const proposalsData = await proposalsResp.json();

    proposalsList.innerHTML = ""; // limpiar

    proposalsData.proposals.forEach(p => {
      const tally = p.final_tally_result;
      let totalVotes = parseInt(tally.yes) + parseInt(tally.no) + parseInt(tally.abstain) + parseInt(tally.no_with_veto);

      // evitar divisi√≥n entre 0
      const yes = totalVotes ? ((parseInt(tally.yes) / totalVotes) * 100).toFixed(1) : 0;
      const no = totalVotes ? ((parseInt(tally.no) / totalVotes) * 100).toFixed(1) : 0;
      const abstain = totalVotes ? ((parseInt(tally.abstain) / totalVotes) * 100).toFixed(1) : 0;
      const veto = totalVotes ? ((parseInt(tally.no_with_veto) / totalVotes) * 100).toFixed(1) : 0;

      proposalsList.innerHTML += `
        <div style="border:1px solid #ccc; margin:10px; padding:10px; border-radius:5px;">
          <p><b>Propuesta #${p.proposal_id}:</b> ${p.content?.title || "Sin t√≠tulo"}</p>
          <p><b>Estado:</b> ${p.status}</p>
          <p>
            ‚úÖ Yes: ${yes}% &nbsp; 
            ‚ùå No: ${no}% &nbsp; 
            ‚ö™ Abstain: ${abstain}% &nbsp; 
            üö´ Veto: ${veto}%
          </p>
        </div>
      `;
    });

  } catch (error) {
    console.error(error);
    walletInfo.innerHTML = "<p style='color:red;'>Error al consultar datos. Intenta m√°s tarde.</p>";
  }
}
</script>
